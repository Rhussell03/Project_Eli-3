<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Eli's Planner</title>
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; }
    html, body {
      margin:0; padding:0;
      font-family: 'Patrick Hand', cursive;
      background: linear-gradient(to bottom, #d0f5c8, #6ea978);
      overflow: hidden; height:100vh; position: relative;
    }
    .rain-emoji {
      position:absolute;
      font-size:1.5rem;
      animation: fall 6s linear infinite;
      opacity:0.8;
      z-index:0;
    }
    @keyframes fall {
      0% { transform:translateY(-50px); }
      100% { transform:translateY(110vh); }
    }
    .menu-icon {
      position:absolute;
      top:10px;
      left:10px;
      font-size:2rem;
      cursor:pointer;
      z-index:1001;
    }
    .sidebar {
      position:fixed;
      top:0; left:-340px;
      width:340px; height:100%;
      background:#b7e5b0;
      box-shadow:5px 0 15px rgba(0,0,0,0.2);
      transition:left .3s;
      z-index:1000;
      display:flex; flex-direction:column;
    }
    .sidebar.active { left:0; }
    .close-bar {
      background: #e05656;
      padding: 0.4rem;
      display: flex;
      justify-content: flex-end;
    }
    .close-btn {
      font-size: 1.4rem;
      color: white;
      cursor: pointer;
    }
    .sidebar h2 {
      font-size:1.2rem;
      margin:1rem;
    }
    .month-pill {
      margin: .4rem 1rem 0;
      padding:.4rem .8rem;
      background:#86c9dc;
      color:white;
      font-size:.9rem;
      border-radius:8px;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .plan-list {
      margin: 0.3rem 1.5rem;
      font-size: 0.9rem;
    }
    .top-bar {
      text-align:center;
      padding:1rem 0 0;
      color:#2e4b2d;
    }
    .planner-head { margin:0; font-size:2rem; }
    .time-display { font-size:1.1rem; }
    .planner-container {
      max-width:1000px; margin:auto;
      display:flex; align-items:center;
      justify-content:center;
      height:calc(100vh - 100px);
      position:relative;
      z-index:3;
    }
    .arrow {
      font-size:2rem;
      padding:1rem;
      background:rgba(255,255,255,0.8);
      border-radius:50%;
      cursor:pointer;
      user-select:none;
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      z-index:10;
    }
    .arrow.left { left:-90px; }
    .arrow.right { right:-90px; }
    .planner {
      background:white; border-radius:12px; padding:1rem;
      box-shadow:0 0 15px rgba(0,0,0,0.1);
      width:100%; height:100%;
      display:flex; flex-direction:column;
    }
    .month-label {
      text-align:center; font-size:1.5rem;
      margin-bottom: .3rem;
    }
    .day-names {
      display:grid; grid-template-columns:repeat(7,1fr);
      text-align:center; font-weight:bold; margin-bottom:.3rem;
    }
    .month-view {
      display:grid; grid-template-columns:repeat(7,1fr);
      gap:.5rem; flex-grow:1;
    }
    .day {
      position:relative; background:#f8fff8;
      border:1px solid #c9e6c9; border-radius:10px;
      padding:.5rem; font-size:.9rem; cursor:pointer;
    }
    .day.today { background:#fff8a8; border:2px solid #f1ce59; }
    .plan-badge {
      background:#86c9dc; color:white;
      padding:.1rem .3rem; margin:.2rem 0;
      display:flex; justify-content:space-between;
      align-items:center; border-radius:5px;
      font-size:.7rem;
    }
    .plan-badge button {
      background:transparent; border:none;
      cursor:pointer; color:white; font-size:1rem;
    }
    .popup-form {
      position:fixed; top:50%; left:50%;
      transform:translate(-50%,-50%);
      background:white; padding:1rem; border-radius:10px;
      box-shadow:0 0 20px rgba(0,0,0,0.3);
      z-index:2000; display:none;
      flex-direction:column; gap:.5rem; width:260px;
    }
    .popup-form select {
      width:30%; padding:.3rem; font-size:1rem;
    }
    .popup-form button {
      width:100%; padding:.5rem;
      border:none; border-radius:5px;
      cursor:pointer; font-size:.9rem;
    }
    .add-btn { background:#86c9dc; }
    .close-btn-form { background:#ef4444; color:white; }
    .settings {
      margin:1rem;
      font-size:0.9rem;
    }
  </style>
</head>
<body>
    <script>
  const rainEmojis = ['ü¶ä','üê∏','üå∏'];
  for(let i=0;i<40;i++){
    const d=document.createElement('div');
    d.className='rain-emoji';
    d.textContent=rainEmojis[i%3];
    d.style.left=Math.random()*100+'vw';
    d.style.animationDuration=(5+Math.random()*5)+'s';
    d.style.fontSize=(1+Math.random()*1.4)+'rem';
    document.body.appendChild(d);
  }
</script>

<div class="menu-icon" onclick="toggleSidebar()">‚ò∞</div>
<div class="sidebar" id="sidebar">
  <div class="close-bar"><div class="close-btn" onclick="toggleSidebar()">‚úñ</div></div>
  <h2>Hey Eli!<br>Here are your upcoming plans! ^w^)/</h2>
  <div id="monthPills"></div>
  <div class="settings">
    <label><input type="checkbox" id="notifToggle" checked> Enable notifications</label>
  </div>
</div>

<div class="top-bar">
  <h1 class="planner-head">‚ùÄ‚ô•Eli's Planner‚ô•‚ùÄ</h1>
  <div class="time-display" id="timeDisplay">it‚Äôs --:--:--</div>
</div>

<div class="planner-container">
  <div class="arrow left" onclick="changeMonth(-1)">‚Üê</div>
  <div class="planner">
    <div class="month-label" id="monthLabel">Month Year</div>
    <div class="day-names">
      <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div>
      <div>Thu</div><div>Fri</div><div>Sat</div>
    </div>
    <div class="month-view" id="monthView"></div>
  </div>
  <div class="arrow right" onclick="changeMonth(1)">‚Üí</div>
</div>

<div class="popup-form" id="popupForm">
  <strong id="formDateLabel">Date</strong>
  <input id="planName" placeholder="Plan name" />
  <div>
    <select id="hour"></select> :
    <select id="minute"></select>
    <select id="ampm"><option>AM</option><option>PM</option></select>
  </div>
  <button class="add-btn" onclick="savePlan()">Add Plan</button>
  <button class="close-btn-form" onclick="popupForm.style.display='none'">Close</button>
</div>

<audio id="notifSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

<script>
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();
let selectedDay = null;
const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
let plans = JSON.parse(localStorage.getItem('plans') || '{}');
const holidays = { "12-25": "üéÑ Christmas" };
const monthLabel = document.getElementById("monthLabel"),
      monthView = document.getElementById("monthView"),
      popupForm = document.getElementById("popupForm"),
      planName = document.getElementById("planName"),
      formDateLabel = document.getElementById("formDateLabel"),
      hourSel = document.getElementById("hour"),
      minuteSel = document.getElementById("minute"),
      ampmSel = document.getElementById("ampm"),
      notifToggle = document.getElementById("notifToggle"),
      timeDisplay = document.getElementById("timeDisplay"),
      sidebar = document.getElementById("sidebar"),
      monthPills = document.getElementById("monthPills"),
      notifSound = document.getElementById("notifSound");
function toggleSidebar() {
  sidebar.classList.toggle("active");
  renderSidebar();
}

function updateTime() {
  const now = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Manila" }));
  const h = now.getHours().toString().padStart(2, '0');
  const m = now.getMinutes().toString().padStart(2, '0');
  const s = now.getSeconds().toString().padStart(2, '0');
  timeDisplay.textContent = `it‚Äôs ${h}:${m}:${s}`;
}
setInterval(updateTime, 500);
updateTime();

function renderCalendar() {
  monthLabel.textContent = `${monthNames[currentMonth]} ${currentYear}`;
  monthView.innerHTML = "";
  const today = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Manila" }));
  const firstDay = new Date(currentYear, currentMonth, 1).getDay();
  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

  for (let i = 0; i < firstDay; i++) {
    monthView.appendChild(document.createElement("div"));
  }

  for (let d = 1; d <= daysInMonth; d++) {
    const key = `${currentYear}-${currentMonth + 1}-${d}`;
    const cell = document.createElement("div");
    cell.className = "day";
    if (
      d === today.getDate() &&
      currentMonth === today.getMonth() &&
      currentYear === today.getFullYear()
    ) {
      cell.classList.add("today");
    }

    cell.onclick = () => openForm(d);
    cell.innerHTML = `<div><strong>${d}</strong></div>`;

    const monthDay = `${(currentMonth + 1).toString().padStart(2, "0")}-${d.toString().padStart(2, "0")}`;
    if (holidays[monthDay]) {
      const h = document.createElement("div");
      h.style.fontSize = "0.6rem";
      h.textContent = holidays[monthDay];
      cell.appendChild(h);
    }

    (plans[key] || []).forEach((p, i) => {
      const badge = document.createElement("div");
      badge.className = "plan-badge";
      badge.innerHTML = `${p.name} @${p.time}<button onclick="removePlan('${key}',${i}); event.stopPropagation()">‚úñ</button>`;
      cell.appendChild(badge);
    });
    monthView.appendChild(cell);
  }
}

function openForm(day) {
  selectedDay = day;
  formDateLabel.textContent = `${monthNames[currentMonth]} ${day}, ${currentYear}`;
  planName.value = "";
  popupForm.style.display = "flex";
}

function savePlan() {
  if (!planName.value.trim()) return;
  const time = `${hourSel.value}:${minuteSel.value} ${ampmSel.value}`;
  const key = `${currentYear}-${currentMonth + 1}-${selectedDay}`;
  plans[key] = plans[key] || [];
  plans[key].push({ name: planName.value.trim(), time });
  localStorage.setItem("plans", JSON.stringify(plans));
  renderCalendar();
  renderSidebar();
  popupForm.style.display = "none";
}

function removePlan(key, index) {
  plans[key].splice(index, 1);
  if (plans[key].length === 0) delete plans[key];
  localStorage.setItem("plans", JSON.stringify(plans));
  renderCalendar();
  renderSidebar();
}

function changeMonth(offset) {
  currentMonth += offset;
  if (currentMonth > 11) { currentMonth = 0; currentYear++; }
  if (currentMonth < 0) { currentMonth = 11; currentYear--; }
  renderCalendar();
  renderSidebar();
}

function renderSidebar() {
  monthPills.innerHTML = "";
  const grouped = {};
  for (const key in plans) {
    const [y, m, d] = key.split("-");
    const label = `${monthNames[parseInt(m) - 1]} ${y}`;
    grouped[label] = grouped[label] || [];
    plans[key].forEach((p, i) => {
      grouped[label].push({ key, idx: i, p });
    });
  }

  Object.entries(grouped).forEach(([label, items]) => {
    const pill = document.createElement("div");
    pill.className = "month-pill";
    const arrow = document.createElement("span");
    arrow.textContent = "‚ñº";
    pill.appendChild(document.createTextNode(`${label} (${items.length})`));
    pill.appendChild(arrow);
    const planList = document.createElement("div");
    planList.className = "plan-list";
    planList.style.display = "none";

    items.forEach(({ key, idx, p }) => {
      const div = document.createElement("div");
      div.innerHTML = `${key.replace(/-/g, "/")} - ${p.name} @ ${p.time}
        <button onclick="removePlan('${key}',${idx}); event.stopPropagation()">‚úñ</button>`;
      planList.appendChild(div);
    });

    pill.onclick = () => {
      const open = planList.style.display === "block";
      planList.style.display = open ? "none" : "block";
      arrow.textContent = open ? "‚ñº" : "‚ñ≤";
    };

    monthPills.appendChild(pill);
    monthPills.appendChild(planList);
  });
}

for (let h = 1; h <= 12; h++) {
  let o = document.createElement("option");
  o.value = h;
  o.textContent = h;
  hourSel.appendChild(o);
}
for (let m = 0; m < 60; m++) {
  let o = document.createElement("option");
  o.value = o.textContent = m.toString().padStart(2, "0");
  minuteSel.appendChild(o);
}

setInterval(() => {
  if (!notifToggle.checked) return;
  const now = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Manila" }));
  const hour = now.getHours();
  const minute = now.getMinutes();
  const ampm = hour >= 12 ? "PM" : "AM";
  const hr12 = ((hour + 11) % 12 + 1);
  const timeStr = `${hr12}:${minute.toString().padStart(2, "0")} ${ampm}`;
  const todayKey = `${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`;
  (plans[todayKey] || []).forEach(p => {
    if (p.time === timeStr && !p.notified) {
      p.notified = true;
      alert(`üîî Reminder: ${p.name} at ${p.time}`);
      notifSound.play();
    }
  });
  localStorage.setItem("plans", JSON.stringify(plans));
}, 30000);

renderCalendar();
renderSidebar();
</script>
</body>
</html>

